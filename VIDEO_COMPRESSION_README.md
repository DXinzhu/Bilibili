# 视频压缩脚本使用说明

## 📋 功能说明

这个脚本用于压缩 `app/src/main/res/raw` 目录下的所有视频文件，以减小 APK 体积。

**当前视频文件总大小：约 961MB**

## 🔧 前置要求

### 1. 安装 Python
- 确保已安装 Python 3.6 或更高版本
- 检查方法：在命令行运行 `python --version`

### 2. 安装 FFmpeg
FFmpeg 是视频处理工具，必须安装才能运行脚本。

**安装方法（选择其一）：**

#### 方法 A：使用 Chocolatey（推荐）
```bash
choco install ffmpeg
```

#### 方法 B：手动安装
1. 访问 https://ffmpeg.org/download.html
2. 下载 Windows 版本（推荐 gyan.dev 或 BtbN 构建版本）
3. 解压到任意目录（如 `C:\ffmpeg`）
4. 将 `bin` 目录添加到系统 PATH 环境变量
   - 右键"此电脑" → 属性 → 高级系统设置 → 环境变量
   - 在"系统变量"中找到 Path，点击编辑
   - 添加 FFmpeg 的 bin 目录路径（如 `C:\ffmpeg\bin`）
5. 重启命令行窗口，运行 `ffmpeg -version` 验证安装

## 🚀 使用方法

### 方法 1：双击运行（推荐）
直接双击 `compress_videos.bat` 文件

### 方法 2：命令行运行
```bash
cd D:\AndroidStudioProject\Bilibili-main
python compress_videos.py
```

## ⚙️ 压缩参数说明

脚本使用以下默认设置（可在 `compress_videos.py` 中修改）：

| 参数 | 默认值 | 说明 | 可选值 |
|------|--------|------|--------|
| 视频码率 | 500k | 控制视频质量和大小 | 300k-1000k |
| 音频码率 | 64k | 控制音频质量 | 32k-128k |
| 分辨率 | 1280x720 | 视频分辨率 | 640x360, 854x480, 1280x720 |
| 帧率 | 24fps | 每秒帧数 | 15-30 |
| CRF质量 | 23 | 质量参数（越大文件越小） | 18-28 |
| 预设 | faster | 编码速度 | ultrafast, faster, medium, slow |

### 调整压缩参数

如果需要更高的压缩率（更小的文件），可以修改以下参数：

**更激进的压缩（文件更小，质量稍低）：**
```python
COMPRESSION_SETTINGS = {
    'video_bitrate': '300k',      # 降低视频码率
    'audio_bitrate': '48k',       # 降低音频码率
    'scale': '854:480',           # 降低到 480p
    'fps': '20',                  # 降低帧率
    'crf': '26',                  # 提高 CRF 值
}
```

**保守的压缩（文件较大，质量较高）：**
```python
COMPRESSION_SETTINGS = {
    'video_bitrate': '800k',      # 提高视频码率
    'audio_bitrate': '96k',       # 提高音频码率
    'scale': '1280:720',          # 保持 720p
    'fps': '24',                  # 保持 24fps
    'crf': '20',                  # 降低 CRF 值
}
```

## 📁 文件结构

运行脚本后会创建以下目录：

```
app/src/main/res/raw/
├── video_1.mp4 ... video_12.mp4  (压缩后的文件，已替换原文件)
├── backup_original/               (原始文件备份)
│   ├── video_1.mp4
│   └── ...
└── compressed/                    (压缩后的文件副本)
    ├── video_1.mp4
    └── ...
```

## 🔄 工作流程

1. **检查环境**：验证 FFmpeg 是否已安装
2. **扫描文件**：查找所有 .mp4 文件
3. **显示设置**：展示压缩参数
4. **用户确认**：等待用户确认是否继续
5. **备份原文件**：将原始文件复制到 `backup_original` 目录
6. **压缩视频**：使用 FFmpeg 压缩每个视频
7. **替换文件**：用压缩后的文件替换原文件
8. **显示统计**：展示压缩率和节省的空间

## 📊 预期效果

根据当前设置，预计可以将视频文件压缩到原大小的 **20-40%**：

- 原始大小：约 961MB
- 压缩后预计：约 200-400MB
- 节省空间：约 500-750MB

## ⚠️ 注意事项

1. **备份重要**：原始文件会自动备份到 `backup_original` 目录
2. **不可逆操作**：压缩会降低视频质量，无法完全恢复
3. **测试建议**：首次使用建议先测试 1-2 个视频，确认效果满意后再批量处理
4. **磁盘空间**：确保有足够的磁盘空间（至少需要 2GB 空闲空间）
5. **清理文件**：压缩完成并确认效果后，可以删除 `backup_original` 和 `compressed` 目录

## 🛠️ 故障排除

### 问题 1：提示"未找到 FFmpeg"
**解决方法**：
- 确认 FFmpeg 已正确安装
- 检查 FFmpeg 是否在系统 PATH 中
- 重启命令行窗口或重启电脑

### 问题 2：压缩后视频无法播放
**解决方法**：
- 从 `backup_original` 目录恢复原始文件
- 调整压缩参数（降低 CRF 值，提高码率）
- 检查 FFmpeg 版本是否过旧

### 问题 3：压缩率不理想
**解决方法**：
- 降低视频码率（如改为 300k）
- 降低分辨率（如改为 480p）
- 提高 CRF 值（如改为 26）

### 问题 4：压缩速度太慢
**解决方法**：
- 将 preset 改为 'ultrafast' 或 'veryfast'
- 注意：更快的预设可能导致文件稍大

## 📝 示例输出

```
============================================================
视频压缩脚本
============================================================
✓ FFmpeg 已安装

找到 12 个视频文件

压缩设置：
  视频码率: 500k
  音频码率: 64k
  分辨率: 1280:720
  帧率: 24 fps
  CRF质量: 23

============================================================
是否继续压缩？(y/n): y

开始压缩...
============================================================

[1/12] 处理: video_1.mp4
  原始大小: 21.00 MB
  备份到: app\src\main\res\raw\backup_original\video_1.mp4
  压缩中...
  ✓ 压缩完成
  压缩后大小: 6.50 MB
  压缩率: 69.0%
  ✓ 已替换原始文件

...

============================================================
压缩完成！
============================================================
成功压缩: 12/12 个文件
原始总大小: 961.00 MB
压缩后总大小: 280.50 MB
总压缩率: 70.8%
节省空间: 680.50 MB

原始文件已备份到: app\src\main\res\raw\backup_original
压缩文件保存在: app\src\main\res\raw\compressed

提示：如果压缩效果满意，可以删除 backup_original 和 compressed 目录
```

## 🔗 相关资源

- FFmpeg 官网：https://ffmpeg.org/
- FFmpeg 文档：https://ffmpeg.org/documentation.html
- H.264 编码指南：https://trac.ffmpeg.org/wiki/Encode/H.264

## 📞 支持

如有问题，请检查：
1. Python 和 FFmpeg 是否正确安装
2. 是否有足够的磁盘空间
3. 视频文件是否损坏
4. 压缩参数是否合理
